---
title: 日志规范
date: 2018-06-28 00:10:05
categories: Tech
---

**SLF4J**(Simple Logging Facade for Java)作为日志框架的抽象API，独立于任何日志实现，适用于logback、log4j、java.util.logging等，这样在多个项目中就不用维护不同的日志API了，而log4j作为高性能异步日志实现，slf4j+log4j是很多java项目的选择，log4j有两个版本，使用log4j第一版需要3个包：

`slf4j-api` `log4j` `slf4j-log4j12(桥接适配包)`

使用log4j第二版需要4个包：

`slf4j-api` `log4j-api` `log4j-core`  `log4j-slf4j-impl(桥接适配包)`

<!-- more -->

### 占位符

相比字符串拼接更简洁，日志输出性能更高。

```java
logger.info("userId:{}, orderId:{}", userId, orderId);
```

### 日志冲突

桥接适配包有且只能有一个，故如果有了`log4j-slf4j-impl`，就需要把`slf4j-log4j12` `slf4j-jdk14` `slf4j-jcl`等桥接包exclude掉，避免冲突和输出日志异常，举例：

```java
SLF4J: Detected both log4j-over-slf4j.jar AND slf4j-log4j12.jar on the class path, preempting StackOverflowError. 
SLF4J: See also http://www.slf4j.org/codes.html#log4jDelegationLoop for more details.
java.lang.ExceptionInInitializerError: null
	...
Caused by: java.lang.IllegalStateException: Detected both log4j-over-slf4j.jar AND slf4j-log4j12.jar on the class path, preempting StackOverflowError. See also http://www.slf4j.org/codes.html#log4jDelegationLoop for more details.
	at org.apache.log4j.Log4jLoggerFactory.<clinit>(Log4jLoggerFactory.java:51) ~[log4j-over-slf4j-1.7.10.jar:1.7.10]
```
### 日志级别

常用只需要四种就行了：ERROR、WARN、INFO、DEBUG。

### 日志中心

多机器上的日志，没法一台台查看，日志中心基于Elasticsearch，提供以下能力：

- 分布式日志收集
- 实时多维度日志搜索
- 查询平台和API接口
- 可视化分析
- 异常报警
- 在线调整日志Level，无需上线，减少日志输出提高性能，或增加日志输出debug