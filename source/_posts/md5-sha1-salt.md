---
title: MD5 / SHA-1 + Salt
date: 2017-03-19 14:27:16
categories: Tech
---

前面一篇博客谈到了hash函数，MD5和SHA-1也是其著名应用之一，他们被广泛应用于互联网的密码、文件、数据、HTTPS数字证书签名等校验中，但近年来陆续被证明可碰撞性被认为不再安全，[2017年Google宣布攻破了SHA-1算法](https://security.googleblog.com/2017/02/announcing-first-sha1-collision.html)，Google从实际行动上提醒大家SHA-1不再安全，本文谈一下MD5/SHA-1和他们加盐(Salt)后在密码校验中的应用。

<!-- more -->

### MD5和SHA-1

MD5输出128位，SHA-1输出160位，SHA-1是基于MD5研发的，他们最重要的应用之一就是文件校验。比如下载软件会告诉你一个MD5哈希值，下载后你可以用`md5sum`监测其MD5值是否和网站给的值相同，用以监测文件的完整性，因为只要任意改动文件一处，那么MD5值就完全不同。

但是Google宣布他们找到了两个SHA-1值相同的PDF文件，实现了碰撞，那么也就是说攻击者有可能用hash值相同的恶意文件冒充原文件，SHA-1在互联网上有那么多的应用该怎么办呢，甚至包括了HTTPS数字证书签名、GIT/SVN等。不过SHA-1也不是谁都能破解的，也就是Google这么强大的计算能力才做到了，普通黑客破解的成本太大，但是为了避免以后潜在的安全漏洞，Google推荐使用更加安全的SHA-256算法。

### MD5/SHA-1 + Salt密码校验

下面列了几种密码存储方式：

1. raw_password
2. hash(raw_password)
3. hash(raw_password + salt)
4. more_hash(hash(raw_password + salt))

hash/more_hash函数可以是MD5、SHA-1、SHA-256甚至是你自己定义的算法，上面四种方法可以说安全性依次递增，首先第一种明文保存密码不用说肯定是不可取的，但是[CSDN当年就泄露了明文保存的密码](http://www.williamlong.info/archives/2933.html)。

其次第二种只是简单映射了明文密码，黑客如果拿到了数据库，那么可以用彩虹表快速找出其中所有弱密码的用户，这也是相当不安全的。

第三种是一般常用的方法，也是相对安全的方法，这里的salt对于每个用户都是随机值，这样保证了即使两个密码一样的用户其hash值也不一样。这样黑客即使拿到了数据库里的`hash_password`和`salt`，也没法通过一个弱密码的`hash(raw_password + salt)`值找到所有账户配对，而是需要穷举各种弱密码+salt的hash值来配对某一个用户，如果网站保证了所有用户密码的复杂度(非123456/password/生日等)，那么用穷举法破解还是比较困难的。当然要注意这里的salt必须是随机不同的，不能是固定值，要不然就跟方法二没有区别了。

第四种方法就是第三种的增强版，可以用一些MD5/SHA-1的迭代或者SHA-256，甚至自定义hash函数，这样让黑客也没法直接按照rainbow table查找了，本质上是一样的，但是增加了一些破解成本。

总结就是要做到绝对安全很难，加密和破解技术是并行发展的，为了自己的账户安全，还是尽量用复杂的密码。现在网络上隐私泄露越来越严重，加上经常曝光的网站泄露账户事件，个人认为可以用两个复杂的密码，一个用于你认为比较重要的网站上，另外一个用于不重要或者你认为不可靠的网站上，这样如果他们的数据库泄露也不会影响到自己其他重要网站的账户安全。

### 参考资料

http://blog.sina.com.cn/s/blog_77e8d1350100wfc7.html